<!-- room.html -->
<!DOCTYPE html>
<html>
<head>
  <title>My Room - Building Maintenance</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h2>🔍 My Room Details</h2>
  <input type="text" id="roomInput" placeholder="Enter Your Room No" class="btn">
  <input type="password" id="roomPass" placeholder="Enter Password" class="btn">
  <button class="btn" onclick="fetchRoomData()">🔎 View</button>
  <div id="roomDetails"></div>

  <script>
    function fetchRoomData() {
      const room = document.getElementById("roomInput").value;
      const pass = document.getElementById("roomPass").value;

      firebase.database().ref(`roomUsers/${room}`).once("value").then(snap => {
        const data = snap.val();
        if (!data || data.password !== pass) return alert("❌ Invalid Room or Password");

        firebase.database().ref(`maintenance/${room}`).once("value").then(snapshot => {
          const maint = snapshot.val();
          let html = `<div class='card'><h3>📘 Maintenance Record for Room ${room}</h3>`;
          for (let date in maint) {
            const m = maint[date];
            html += `<p>📅 ${date} | Paid: ₹${m.paid}, Due: ₹${m.due}, Mode: ${m.paymentMode}, Desc: ${m.description}</p>`;
          }
          html += `</div>`;
          document.getElementById("roomDetails").innerHTML = html;
        });
      });
    }
  </script>
</body>
</html>


<!-- admin.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Building Maintenance</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h2>🛠 Admin Dashboard</h2>

  <!-- Room Maintenance Entry -->
  <div class="card">
    <h3>🏠 Room Maintenance Entry</h3>
    <input type="text" id="maintRoom" placeholder="Room No" class="btn">
    <input type="number" id="maintPaid" placeholder="Amount Paid ₹" class="btn">
    <input type="text" id="maintDesc" placeholder="Description (e.g. July Maintenance)" class="btn">
    <label>Payment Mode:</label>
    <select id="paymentMode" class="btn">
      <option value="Cash">Cash</option>
      <option value="Online">Online</option>
      <option value="Cheque">Cheque</option>
      <option value="Other">Other</option>
    </select>
    <button class="btn" onclick="addRoomMaintenance()">💾 Save Maintenance</button>
  </div>

  <!-- Building Expenses Entry -->
  <div class="card">
    <h3>🏗️ Building Expenses Entry</h3>
    <input type="text" id="expenseWork" placeholder="Work Done (e.g. Light Bill)" class="btn">
    <input type="number" id="expenseAmount" placeholder="Amount ₹" class="btn">
    <input type="date" id="expenseDate" class="btn">
    <button class="btn" onclick="addBuildingExpense()">💾 Save Expense</button>
  </div>

  <!-- Logout -->
  <button class="btn" onclick="logout()">🚪 Logout</button>

  <script>
    firebase.auth().onAuthStateChanged(user => {
      if (!user || user.email !== "ngogrant454@gmail.com") {
        alert("⛔ Unauthorized access!");
        window.location.href = "index.html";
      }
    });

    function addRoomMaintenance() {
      const room = document.getElementById("maintRoom").value.trim();
      const paid = parseInt(document.getElementById("maintPaid").value.trim());
      const desc = document.getElementById("maintDesc").value.trim();
      const paymentMode = document.getElementById("paymentMode").value;
      const charge = 400;
      const due = charge - paid;
      const date = new Date().toLocaleDateString("en-GB").replace(/\//g, "-");

      if (!room || isNaN(paid)) {
        alert("❗ कृपया Room No. और Amount Paid भरें");
        return;
      }

      const entry = {
        charge: charge,
        paid: paid,
        due: due,
        description: desc,
        paymentMode: paymentMode,
        date: date
      };

      firebase.database().ref(`maintenance/${room}/${date}`).set(entry).then(() => {
        alert("✅ Maintenance Entry Saved");
      });
    }

    function addBuildingExpense() {
      const work = document.getElementById("expenseWork").value.trim();
      const amount = parseInt(document.getElementById("expenseAmount").value.trim());
      const date = document.getElementById("expenseDate").value;

      if (!work || isNaN(amount) || !date) {
        alert("❗ सभी फ़ील्ड भरना ज़रूरी है");
        return;
      }

      firebase.database().ref(`expenses/${date}`).push({ work, amount, date }).then(() => {
        alert("✅ Expense Entry Saved");
      });
    }

    function logout() {
      firebase.auth().signOut().then(() => location.href = 'index.html');
    }
  </script>
</body>
</html>
