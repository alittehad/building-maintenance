<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building Maintenance Admin</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 10px; background: #f1f1f1; }
    .card { background: white; padding: 15px; margin: 15px auto; max-width: 600px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    input, button, select, textarea { width: 100%; margin: 5px 0; padding: 10px; box-sizing: border-box; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .scroll-box { background: #ffffff; padding: 10px; margin: 10px auto; max-width: 600px; height: 50px; overflow: hidden; border-radius: 10px; }
    .marquee { white-space: nowrap; display: inline-block; animation: scroll 15s linear infinite; }
    @keyframes scroll { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    .led { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    .led-red { background-color: red; animation: blink 1s infinite; }
    .led-green { background-color: green; animation: blink 1s infinite; }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
  </style>
</head>
<body>
<h2>ğŸ¢ Building Maintenance Dashboard</h2>
<div id="noticeBar" class="scroll-box"><div class="marquee" id="noticeMarquee">ğŸ“¢ Notice Board Loading...</div></div>
<div id="complaintBar" class="scroll-box"><div class="marquee" id="complaintMarquee">ğŸ—£ Complaint Board Loading...</div></div>

<!-- Login -->
<div id="loginBox">
  <button onclick="login()">ğŸ” Login with Google</button>
</div>

<!-- Admin Panel -->
<div id="adminPanel" style="display:none">
  <div class="card">
    <h3>ğŸ“¢ Post Notice</h3>
    <textarea id="noticeText" placeholder="Type notice..."></textarea>
    <button onclick="postNotice()">Post Notice</button>
  </div>

  <div class="card">
    <h3>ğŸ  Add Maintenance</h3>
    <input id="maintRoom" placeholder="Room No" />
    <input id="maintPaid" type="number" placeholder="Paid â‚¹" />
    <input id="maintDesc" placeholder="Description" />
    <select id="paymentMode">
      <option value="Cash">Cash</option>
      <option value="Online">Online</option>
    </select>
    <button onclick="addMaintenance()">Save Maintenance</button>
  </div>

  <div class="card">
    <h3>ğŸ’¡ Building Expense</h3>
    <input id="expenseDesc" placeholder="Expense Detail" />
    <input id="expenseAmt" type="number" placeholder="Amount â‚¹" />
    <input id="expenseDate" type="date" />
    <button onclick="addExpense()">Save Expense</button>
  </div>

  <div class="card">
    <h3>ğŸ” Search Maintenance</h3>
    <input id="searchRoom" placeholder="Room No" />
    <input id="searchDate" placeholder="dd-mm-yyyy" />
    <button onclick="searchMaintenance()">Search</button>
    <div id="searchResults"></div>
  </div>

  <div class="card">
    <h3>ğŸ›  Handle Complaints</h3>
    <div id="adminComplaints"></div>
  </div>
</div>

<script>
  const adminEmail = "ngogrant454@gmail.com";
  const firebaseConfig = { /* your firebase config */ };
  firebase.initializeApp(firebaseConfig);

  function login() {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).then(res => {
      const user = res.user;
      document.getElementById("loginBox").style.display = "none";
      if (user.email === adminEmail) {
        document.getElementById("adminPanel").style.display = "block";
        loadAllData();
      }
    });
  }

  function postNotice() {
    const text = document.getElementById("noticeText").value;
    const time = new Date().toLocaleString();
    firebase.database().ref("notices").push({ text, time });
    document.getElementById("noticeText").value = "";
  }

  function loadAllData() {
    firebase.database().ref("notices").once("value").then(snap => {
      let html = "";
      snap.forEach(c => html += `ğŸ“¢ ${c.val().text} &nbsp;&nbsp;`);
      document.getElementById("noticeMarquee").innerHTML = html;
    });

    firebase.database().ref("complaints").once("value").then(snap => {
      let html = "";
      let adminComplaints = "";
      snap.forEach(c => {
        const val = c.val();
        const id = c.key;
        const led = val.status === "approved" ? '<span class="led led-green"></span>Approved' : '<span class="led led-red"></span>Pending';
        html += `ğŸ—£ ${val.text} (${led}) &nbsp;&nbsp;`;
        adminComplaints += `<p>${val.text} (${led}) <button onclick="approveComplaint('${id}')">Approve</button></p>`;
      });
      document.getElementById("complaintMarquee").innerHTML = html;
      document.getElementById("adminComplaints").innerHTML = adminComplaints;
    });
  }

  function approveComplaint(id) {
    firebase.database().ref(`complaints/${id}`).update({ status: "approved" }).then(() => loadAllData());
  }

  function addMaintenance() {
    const room = document.getElementById("maintRoom").value;
    const paid = document.getElementById("maintPaid").value;
    const desc = document.getElementById("maintDesc").value;
    const mode = document.getElementById("paymentMode").value;
    const date = new Date().toLocaleDateString("en-GB").replaceAll("/", "-");
    const due = 400 - paid;
    firebase.database().ref(`maintenance/${room}/${date}`).set({ paid, due, desc, mode, date });
  }

  function addExpense() {
    const desc = document.getElementById("expenseDesc").value;
    const amt = document.getElementById("expenseAmt").value;
    const date = document.getElementById("expenseDate").value;
    firebase.database().ref(`expenses/${date}`).push({ desc, amt });
  }

  function searchMaintenance() {
    const room = document.getElementById("searchRoom").value;
    const date = document.getElementById("searchDate").value;
    const out = document.getElementById("searchResults");
    firebase.database().ref("maintenance").once("value").then(snap => {
      let html = "";
      snap.forEach(r => {
        if (room && r.key !== room) return;
        const dates = r.val();
        for (let d in dates) {
          if (date && d !== date) continue;
          const m = dates[d];
          html += `<p>Room ${r.key} - ${d}: Paid â‚¹${m.paid}, Due â‚¹${m.due}, Mode: ${m.mode}</p>`;
        }
      });
      out.innerHTML = html || "No results";
    });
  }
</script>
</body>
</html>
