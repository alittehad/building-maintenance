<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Building Maintenance System</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body {font-family: Arial; margin:0;padding:10px; background:#f5f5f5;}
    h2{text-align:center;}
    .card{background:#fff;padding:15px;margin:10px auto;max-width:600px;border-radius:8px;box-shadow:0 0 5px rgba(0,0,0,0.1);}
    .scroll-box{background:#fff;padding:10px;margin:10px 0;overflow-x:auto;white-space:nowrap;border-radius:5px;box-shadow:inset 0 0 5px #ccc;}
    .marquee{display:inline-block;animation:scroll 20s linear infinite;}
    @keyframes scroll{0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
    input,textarea,select,button{width:100%;padding:10px;margin-top:8px;border-radius:5px;border:1px solid #ccc;box-sizing:border-box;}
    button{background:#007bff;color:#fff;border:none;font-size:16px;cursor:pointer;}
    button:hover{background:#0056b3;}
    #logoutBtn{background:#dc3545;}
    .hidden{display:none;}
  </style>
</head>
<body>

<h2>ğŸ¢ Building Maintenance System</h2>

<div id="loginBox"><button onclick="login()">ğŸ” Login with Google</button></div>
<div id="logoutBtn" class="hidden"><button onclick="logout()">ğŸšª Logout</button></div>

<div id="noticeBox" class="scroll-box hidden"><strong>ğŸ“¢ Notice Board:</strong><span class="marquee" id="noticeMarquee">Loading...</span></div>
<div id="complaintBox" class="scroll-box hidden"><strong>ğŸ—£ Complaint Board:</strong><span class="marquee" id="complaintMarquee">Loading...</span></div>

<div id="adminPanel" class="hidden">
  <div class="card"><h3>ğŸ“¢ Post Notice</h3><textarea id="noticeText" placeholder="Write notice..."></textarea><button onclick="postNotice()">Post Notice</button></div>
  <div class="card"><h3>ğŸ›  Post Maintenance</h3>
    <input id="maintRoom" placeholder="Room No"><input id="maintPaid" type="number" placeholder="Paid Amount"><input id="maintDesc" placeholder="Description">
    <select id="paymentMode"><option>Cash</option><option>Online</option></select><button onclick="addMaintenance()">Add Maintenance</button>
  </div>
  <div class="card"><h3>ğŸ’¡ Add Expense</h3>
    <input id="expenseWork" placeholder="Work Description"><input id="expenseAmount" type="number" placeholder="Amount"><input id="expenseDate" type="date"><button onclick="addExpense()">Add Expense</button>
  </div>
</div>

<div id="userPanel" class="hidden"><div class="card"><h3>ğŸ“ Submit Complaint</h3><textarea id="complaintText" placeholder="Write complaint..."></textarea><button onclick="submitComplaint()">Submit</button></div></div>

<div id="allMaintenance" class="hidden"><div class="card"><h3>ğŸ” All Maintenance</h3><div id="maintenanceList">Loading...</div></div></div>
<div id="allExpenses" class="hidden"><div class="card"><h3>ğŸ’¡ All Expenses</h3><div id="expenseList">Loading...</div></div></div>

<script>
const adminEmail = "ngogrant454@gmail.com";
let currentUser;

const config = {
  apiKey: "AIzaSyAHGIUaN2JMIXB7HuCM4BjXA97E0bvWYDA",
  authDomain: "al-ittehad-575a0.firebaseapp.com",
  databaseURL: "https://al-ittehad-575a0-default-rtdb.firebaseio.com",
  projectId: "al-ittehad-575a0",
  storageBucket: "al-ittehad-575a0.appspot.com",
  messagingSenderId: "797238238041",
  appId: "1:797238238041:web:89f2aa5c786c59dc374a48"
};
firebase.initializeApp(config);

// Auth listener
firebase.auth().onAuthStateChanged(user => {
  currentUser = user;
  if(user) {
    showAll(true);
    loadNotices();
    loadComplaints();
    loadAllMaintenance();
    loadAllExpenses();
  } else {
    showAll(false);
  }
});

function showAll(show) {
  document.getElementById("loginBox").classList.toggle("hidden", show);
  document.getElementById("logoutBtn").classList.toggle("hidden", !show);
  ["noticeBox","complaintBox","allMaintenance","allExpenses"].forEach(id=>document.getElementById(id).classList.toggle("hidden", !show));
  document.getElementById("adminPanel").classList.toggle("hidden", !(show && currentUser.email===adminEmail));
  document.getElementById("userPanel").classList.toggle("hidden", !(show && currentUser.email!==adminEmail));
}

function login() {
  firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider());
}
function logout() {
  firebase.auth().signOut();
}

function postNotice() {
  const txt=document.getElementById("noticeText").value.trim();
  if(!txt) return alert("Notice text is empty");
  firebase.database().ref("notices").push({text:txt,date:new Date().toLocaleString()});
  document.getElementById("noticeText").value="";
  loadNotices();
}

function loadNotices() {
  firebase.database().ref("notices").once("value").then(snap=>{
    let out="";
    snap.forEach(c=> {let d=c.val(); out+=`ğŸ“¢ ${d.text} (${d.date}) &nbsp;&nbsp;`;});
    document.getElementById("noticeMarquee").innerHTML = out || "ğŸ“¢ no notice available";
  });
}

function submitComplaint() {
  const txt=document.getElementById("complaintText").value.trim();
  if(!txt) return alert("Complaint empty");
  firebase.database().ref("complaints").push({text:txt,date:new Date().toLocaleString(),approved:false});
  document.getElementById("complaintText").value="";
  loadComplaints();
}

function loadComplaints() {
  firebase.database().ref("complaints").once("value").then(snap=>{
    let out="";
    snap.forEach(c=>{let d=c.val(); if(!d.approved) out+=`ğŸ—£ ${d.text} &nbsp;&nbsp;`;});
    document.getElementById("complaintMarquee").innerHTML = out || "ğŸ—£ no complaints";
  });
}

function addMaintenance() {
  const r=document.getElementById("maintRoom").value.trim(),
        p=+document.getElementById("maintPaid").value||0,
        desc=document.getElementById("maintDesc").value,
        mode=document.getElementById("paymentMode").value,
        date=new Date().toLocaleDateString("en-GB").replace(/\//g,"-"),
        due=400-p;
  if(!r) return alert("Room no needed");
  firebase.database().ref(`maintenance/${r}/${date}`).set({room:r,paid:p,due,mode,desc,date});
  loadAllMaintenance();
}

function loadAllMaintenance() {
  firebase.database().ref("maintenance").once("value").then(snap=>{
    let out="";
    snap.forEach(rs=>{rs.forEach(ds=>{let d=ds.val(); out+=`<p>ğŸ“… ${d.date} | Room ${rs.key} | Paid â‚¹${d.paid}, Due â‚¹${d.due}, Mode ${d.mode}<br>${d.desc}</p><hr>`});
    });
    document.getElementById("maintenanceList").innerHTML = out||"No maintenance records";
  });
}

function addExpense() {
  const work=document.getElementById("expenseWork").value.trim(),
        amt=+document.getElementById("expenseAmount").value||0,
        date=document.getElementById("expenseDate").value;
  if(!work||!date) return alert("Enter work & date");
  firebase.database().ref(`expenses/${date}`).push({work,amt});
  loadAllExpenses();
}

function loadAllExpenses() {
  firebase.database().ref("expenses").once("value").then(snap=>{
    let out="";
    snap.forEach(ds=>{ds.forEach(entry=>{let e=entry.val(); out+=`<p>ğŸ“… ${ds.key}<br>${e.work}<br>â‚¹${e.amt}</p><hr>`});});
    document.getElementById("expenseList").innerHTML = out||"No expense records";
  });
}
</script>
</body>
</html>
