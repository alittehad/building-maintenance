<!-- room.html -->
<!DOCTYPE html>
<html>
<head>
  <title>My Room - Building Maintenance</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h2>ğŸ” My Room Details</h2>
  <input type="text" id="roomInput" placeholder="Enter Your Room No" class="btn">
  <input type="password" id="roomPass" placeholder="Enter Password" class="btn">
  <button class="btn" onclick="fetchRoomData()">ğŸ” View</button>
  <div id="roomDetails"></div>

  <script>
    function fetchRoomData() {
      const room = document.getElementById("roomInput").value;
      const pass = document.getElementById("roomPass").value;

      firebase.database().ref(`roomUsers/${room}`).once("value").then(snap => {
        const data = snap.val();
        if (!data || data.password !== pass) return alert("âŒ Invalid Room or Password");

        firebase.database().ref(`maintenance/${room}`).once("value").then(snapshot => {
          const maint = snapshot.val();
          let html = `<div class='card'><h3>ğŸ“˜ Maintenance Record for Room ${room}</h3>`;
          for (let date in maint) {
            const m = maint[date];
            html += `<p>ğŸ“… ${date} | Paid: â‚¹${m.paid}, Due: â‚¹${m.due}, Mode: ${m.paymentMode}, Desc: ${m.description}</p>`;
          }
          html += `</div>`;
          document.getElementById("roomDetails").innerHTML = html;
        });
      });
    }
  </script>
</body>
</html>


<!-- admin.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Building Maintenance</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h2>ğŸ›  Admin Dashboard</h2>

  <!-- Room Maintenance Entry -->
  <div class="card">
    <h3>ğŸ  Room Maintenance Entry</h3>
    <input type="text" id="maintRoom" placeholder="Room No" class="btn">
    <input type="number" id="maintPaid" placeholder="Amount Paid â‚¹" class="btn">
    <input type="text" id="maintDesc" placeholder="Description (e.g. July Maintenance)" class="btn">
    <label>Payment Mode:</label>
    <select id="paymentMode" class="btn">
      <option value="Cash">Cash</option>
      <option value="Online">Online</option>
      <option value="Cheque">Cheque</option>
      <option value="Other">Other</option>
    </select>
    <button class="btn" onclick="addRoomMaintenance()">ğŸ’¾ Save Maintenance</button>
  </div>

  <!-- Building Expenses Entry -->
  <div class="card">
    <h3>ğŸ—ï¸ Building Expenses Entry</h3>
    <input type="text" id="expenseWork" placeholder="Work Done (e.g. Light Bill)" class="btn">
    <input type="number" id="expenseAmount" placeholder="Amount â‚¹" class="btn">
    <input type="date" id="expenseDate" class="btn">
    <button class="btn" onclick="addBuildingExpense()">ğŸ’¾ Save Expense</button>
  </div>

  <!-- Logout -->
  <button class="btn" onclick="logout()">ğŸšª Logout</button>

  <script>
    firebase.auth().onAuthStateChanged(user => {
      if (!user || user.email !== "ngogrant454@gmail.com") {
        alert("â›” Unauthorized access!");
        window.location.href = "index.html";
      }
    });

    function addRoomMaintenance() {
      const room = document.getElementById("maintRoom").value.trim();
      const paid = parseInt(document.getElementById("maintPaid").value.trim());
      const desc = document.getElementById("maintDesc").value.trim();
      const paymentMode = document.getElementById("paymentMode").value;
      const charge = 400;
      const due = charge - paid;
      const date = new Date().toLocaleDateString("en-GB").replace(/\//g, "-");

      if (!room || isNaN(paid)) {
        alert("â— à¤•à¥ƒà¤ªà¤¯à¤¾ Room No. à¤”à¤° Amount Paid à¤­à¤°à¥‡à¤‚");
        return;
      }

      const entry = {
        charge: charge,
        paid: paid,
        due: due,
        description: desc,
        paymentMode: paymentMode,
        date: date
      };

      firebase.database().ref(`maintenance/${room}/${date}`).set(entry).then(() => {
        alert("âœ… Maintenance Entry Saved");
      });
    }

    function addBuildingExpense() {
      const work = document.getElementById("expenseWork").value.trim();
      const amount = parseInt(document.getElementById("expenseAmount").value.trim());
      const date = document.getElementById("expenseDate").value;

      if (!work || isNaN(amount) || !date) {
        alert("â— à¤¸à¤­à¥€ à¤«à¤¼à¥€à¤²à¥à¤¡ à¤­à¤°à¤¨à¤¾ à¤œà¤¼à¤°à¥‚à¤°à¥€ à¤¹à¥ˆ");
        return;
      }

      firebase.database().ref(`expenses/${date}`).push({ work, amount, date }).then(() => {
        alert("âœ… Expense Entry Saved");
      });
    }

    function logout() {
      firebase.auth().signOut().then(() => location.href = 'index.html');
    }
  </script>
</body>
</html>
