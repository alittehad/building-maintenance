<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - Building Maintenance</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>
  <h2>ğŸ›  Admin Dashboard</h2>

  <!-- Room Maintenance Entry -->
  <div class="card">
    <h3>ğŸ  Room Maintenance Entry</h3>
    <input type="text" id="maintRoom" placeholder="Room No"><br><br>
    <input type="number" id="maintPaid" placeholder="Amount Paid â‚¹"><br><br>
    <input type="text" id="maintDesc" placeholder="Description (e.g. July Maintenance)"><br><br>
    
    <label>Payment Mode:</label>
    <select id="paymentMode">
      <option value="Cash">Cash</option>
      <option value="Online">Online</option>
      <option value="Cheque">Cheque</option>
      <option value="Other">Other</option>
    </select><br><br>

    <button onclick="addRoomMaintenance()">â• Save Maintenance</button>
  </div>

  <!-- Building Expenses Entry -->
  <div class="card">
    <h3>ğŸ—ï¸ Building Expenses Entry</h3>
    <input type="text" id="expenseWork" placeholder="Work Done (e.g. Light Bill)"><br><br>
    <input type="number" id="expenseAmount" placeholder="Amount â‚¹"><br><br>
    <button onclick="addBuildingExpense()">â• Save Expense</button>
  </div>

  <!-- Logout -->
  <button onclick="logout()">ğŸšª Logout</button>

  <script>
    firebase.auth().onAuthStateChanged(user => {
      if (!user || user.email !== "ngogrant454@gmail.com") {
        alert("â›” Unauthorized access!");
        window.location.href = "index.html";
      }
    });

    function addRoomMaintenance() {
      const room = document.getElementById("maintRoom").value.trim();
      const paid = parseInt(document.getElementById("maintPaid").value.trim());
      const desc = document.getElementById("maintDesc").value.trim();
      const paymentMode = document.getElementById("paymentMode").value;
      const charge = 400;
      const due = charge - paid;
      const date = new Date().toLocaleDateString("en-GB").replace(/\//g, "-");

      if (!room || isNaN(paid)) {
        alert("â— à¤•à¥ƒà¤ªà¤¯à¤¾ Room No. à¤”à¤° Amount Paid à¤­à¤°à¥‡à¤‚");
        return;
      }

      const entry = {
        charge: charge,
        paid: paid,
        due: due,
        description: desc,
        paymentMode: paymentMode,
        date: date
      };

      firebase.database().ref(`maintenance/${room}/${date}`).set(entry)
        .then(() => {
          alert("âœ… Maintenance Entry Saved");
          document.getElementById("maintRoom").value = "";
          document.getElementById("maintPaid").value = "";
          document.getElementById("maintDesc").value = "";
          document.getElementById("paymentMode").value = "Cash";
        });
    }

    function addBuildingExpense() {
      const work = document.getElementById("expenseWork").value.trim();
      const amount = parseInt(document.getElementById("expenseAmount").value.trim());
      const date = new Date().toLocaleDateString("en-GB").replace(/\//g, "-");

      if (!work || isNaN(amount)) {
        alert("â— Work à¤”à¤° Amount à¤­à¤°à¤¨à¤¾ à¤œà¤¼à¤°à¥‚à¤°à¥€ à¤¹à¥ˆ");
        return;
      }

      firebase.database().ref(`expenses/${date}`).push({
        work: work,
        amount: amount,
        date: date
      }).then(() => {
        alert("âœ… Expense Entry Saved");
        document.getElementById("expenseWork").value = "";
        document.getElementById("expenseAmount").value = "";
      });
    }

    function logout() {
      firebase.auth().signOut().then(() => location.href = 'index.html');
    }
  </script>
</body>
</html>
